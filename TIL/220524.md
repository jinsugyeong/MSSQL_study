# 220524

### 장애와 회복 ###

__1. 장애__
- __트랜잭션 장애__ : 트랜잭션 내에 잘못된 데이터 입력, 데이터 부재, 오버플로우, 자원의 한계 초과 요청, 어떤 수를 0으로 나누게 되는 연산 등
- __시스템 장애__ : 하드웨어의 잘못된 작동으로 메인 메모리에 저장되어 있는 정보 손실, 교착 상태의 발생으로 더 이상 트랜잭션 작업이 수행될 수 없는 상황
- __미디어 장애__ : 디스크 블록 내에 있는 정보는 데이터 전송 도중 디스크 헤드 손상이나 고장으로 인해, 저장 장치 내에 있는 정보가 일부 또는 전부 손상될 수 있는 상태

<br>

__2. 회복__
- 장애가 발생하였을 때, 데이터베이스를 장애가 발생했던 이전의 상태로 복구시켜서 일관된 데이터베이스 상태를 만드는 것이다. 이 상태는 데이터베이스 내에 오류와 모순이 없는 상태를 말한다
- 예기치 않은 사고가 발생했을 때, 해당 데이터의 복사본을 이용하면 다시 복구될 수 있다.
- 복사본을 만드는 기법으로는 덤프(dump), 로그(log)가 있다.
- __덤프__ : 데이터 베이스의 모든 내용을 일정한 주기로 다른 저장 장치에 복사
- __로그__ : 데이터베이스가 변경될 때마다 변경되는 데이터 값의 이전 값과 이후 값을 별도의 1로그 파일에 저장

<br>

__3. 회복을 위해 취할 수 있는 조치__
- __REDO(재수행)__ : 가장 최근에 덤프 받은 복사본 데이터베이스 상태로 만든 다음, 장애 시점까지 완료된 트랜잭션 연산들의 로그 파일을 이용하여 재수행 함으로써, 최근의 상태로 데이터베이스를 복원하는 것   
	`REDO(T_01)` : 트랜잭션 T_01에 의해 변경된 모든 데이터 항목들을 로그 파일에있는 변경 이후 값으로 대체
- __UNDO(취소)__ : 데이터베이스 내용 자체는 손상되지 않았지만, 변경 중이었거나 변경된 데이터 내용에 대한 신뢰성을 잃어버린 경우에 사용한다.   
 즉, 로그 파일을 이용하여 모든 변경된 사항들을 취소시킴으로써 데이터베이스를 원래의 상태로 복원   
	`UNDO(T_01)` : 트랜잭션 T_01에 의해 변경된 모든 데이터 항목들을 로그 파일에 있는 변경 이전 값으로 대체

<br>

__4. 회복의 유형__
- 데이터베이스 로그를 이용한 회복 : 데이터의 변경이 발생할 때 마다 생성되는 로그 파일을 이용, 변경한 내용을 언제 반영하느냐에 따라 지연 갱신 회복 기법과 즉시 갱신 회복 기법으로 나눌 수 있다.
( 로그 레코드 가 어느 트랜잭션에 속하는지를 구별하기 위한 트랜잭션 ID가 포함된다. 트랜잭션 ID는 트랜잭션이 생성될 때마다 부여되는 고유한 번호이다. 또한, 해당 트랜잭션 ID에 속하는 항목의 이전값과 이후 값의 정보도 존재한다.)
	- __지연 갱신 회복__ : 트랜잭션이 부분 완료될 때까지 모든 변경 내용에 대해 데이터베이스 갱신을 지연시키고, 로그 파일에만 저장하는 것을 말한다.
	　트랜잭션 실패로 트랜잭션이 철회되어야 된다면, 로그 파일에 저장된 정보는 그냥 버리고 무시하면 된다.
	　UNDO 연산이 필요 없게 되며, REDO 연산에 대비하여 기록한 데이터 항목의 이후 값만 있으면 되고, UNDO 연산을 위해 대비한 이전 값은 특별히 저장하지 않아도 된다
	- __즉시 갱신 회복__ : 트랜잭션 연산 도중에 데이터 변경 연산이 발생할 때마다 데이터 변경 결과를 즉시 데이터베이스 내에 반영. DB뿐만 아니라 로그 파일에도 변경 정보를 함께 저장하게 된다.   
	트랜잭션을 철회하게 될 때엔느 로그 파일에 저장된 내용을 참조하여 UNDO 연산을 수행. 로그 레코드 값 중 변경 이전 값이 사용된다.
- __검사 시점 회복__ : 로그는 그대로 기록 유지하면서, 회복 관리자가 정하는 일정한 시간 간격으로 검사시점을 생성.불필요한 부하를 줄이게 됨 -> 회복 처리 절차의 시간 절약
- __그림자 페이징 기법__ : 로그를 이용하지 않고, 트랜잭션을 수행하는 동안 두 개의 페이지 테이블인 현재 페이지 테이블과 그림자 페이지 테이블을 유지하는 것.   
처음 트랜잭션을 수행했을 때는 두 개의 페이지 테이블 내용이 동일하지만, 실제 트랜잭션을 수행하는 과정에서는 현재 페이지 테이블만 변경이 일어나고, 그림자 페이지 테이블은 사용하지 않음. -> 그림자 페이지 테이블 변화 x, 트랜잭션 수행 직전의 상태만 유지   
그림자 페이지 테이블은 비휘발성 저장 장치인 하드디스크에 저장하고, 현재 페이지 테이블은 주기억장치에 저장한다.   
- __미디어 회복__ : 덤프를 이용하여 복사본을 만드는 것. 덤프 작업 수행 중 트랜잭션 실행 불가능.   

